<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OsmanlÄ±ca OCR TanÄ±ma - ArapÃ§a Harflerle</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 2rem; background-color: #f9f9f9; }
    video, canvas, img { max-width: 100%; margin-top: 1rem; }
    #result { white-space: pre-wrap; background: #fff; padding: 1rem; border-radius: 5px; margin-top: 1rem; }
    .highlight { background-color: yellow; font-weight: bold; }
    button { margin: 0.3rem; padding: 0.6rem 1rem; font-size: 1rem; }
    #ocr-info { margin-top: 1rem; }
  </style>
</head>
<body>

<h2>ğŸ“¸ OsmanlÄ±ca (Arap Harfleri) GÃ¶rÃ¼ntÃ¼den Metin TanÄ±ma</h2>

<button id="start-camera">KamerayÄ± AÃ§</button>
<button id="capture">ğŸ“· FotoÄŸraf Ã‡ek</button>
<button id="stop-camera">KamerayÄ± Kapat</button>
<button id="upload">ğŸ–¼ï¸ Galeriden SeÃ§</button>
<input type="file" id="file-input" accept="image/*" style="display:none" />

<video id="video" autoplay playsinline width="300" style="display:none;"></video>
<canvas id="canvas" width="300" height="200" style="display:none;"></canvas>
<img id="preview" />

<button id="recognize">ğŸ“ OCR BaÅŸlat</button>

<div id="ocr-info" style="display:none;">
  <p><strong>ğŸ” DoÄŸruluk:</strong> <span id="accuracy">%</span></p>
  <p><strong>ğŸŒ Arama:</strong> <a id="search-link" href="#" target="_blank">Googleâ€™da ara</a></p>
</div>

<div id="result" style="display:none;"></div>

<div id="controls" style="display:none;">
  <button id="copy-btn">ğŸ“‹ Kopyala</button>
  <button id="speak-btn">ğŸ“¢ Oku</button>
  <button id="download-btn">ğŸ“¥ Ä°ndir</button>
</div>

<script>
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const preview = document.getElementById("preview");
  const fileInput = document.getElementById("file-input");

  document.getElementById("start-camera").onclick = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
      video.style.display = "block";
    } catch(e) {
      alert("Kamera aÃ§Ä±lamadÄ±: " + e.message);
    }
  };

  document.getElementById("stop-camera").onclick = () => {
    const stream = video.srcObject;
    if(stream){
      const tracks = stream.getTracks();
      tracks.forEach(track => track.stop());
    }
    video.style.display = "none";
  };

  document.getElementById("capture").onclick = () => {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const dataURL = canvas.toDataURL("image/png");
    preview.src = dataURL;
    preview.style.display = "block";
  };

  document.getElementById("upload").onclick = () => fileInput.click();
  fileInput.onchange = e => {
    const file = e.target.files[0];
    preview.src = URL.createObjectURL(file);
    preview.style.display = "block";
  };

  function highlightSpecial(text) {
    const names = /(efendi|paÅŸa|hanÄ±m|ÅŸeyh|hazret|bey|sultan)/gi;
    const dates = /[0-9]{3,4}[^0-9]?[\u0627-\u06FF]*?/g;
    return text
      .replace(names, match => `<span class="highlight">${match}</span>`)
      .replace(dates, match => `<span class="highlight">${match}</span>`);
  }

  async function recognize() {
    if (!preview.src) {
      alert("LÃ¼tfen Ã¶nce bir fotoÄŸraf seÃ§in veya Ã§ekin.");
      return;
    }
    document.getElementById("result").innerText = "OCR Ã§alÄ±ÅŸÄ±yor...";
    document.getElementById("result").style.display = "block";

    const worker = Tesseract.createWorker({
      logger: m => console.log(m)
    });

    await worker.load();
    await worker.loadLanguage('ara');
    await worker.initialize('ara');

    const { data } = await worker.recognize(preview.src);

    await worker.terminate();

    const highlighted = highlightSpecial(data.text);

    document.getElementById("result").innerHTML = highlighted;
    document.getElementById("controls").style.display = "block";

    document.getElementById("ocr-info").style.display = "block";
    document.getElementById("accuracy").innerText = data.confidence.toFixed(2) + "%";

    // Google'da arama linki (ilk 100 karakterle)
    const query = encodeURIComponent(data.text.slice(0, 100));
    document.getElementById("search-link").href = `https://www.google.com/search?q=${query}`;

    // Ä°stersen localStorage kaydÄ± yapÄ±labilir
  }

  document.getElementById("recognize").onclick = recognize;

  // Kopyala
  document.getElementById("copy-btn").onclick = () => {
    const text = document.getElementById("result").innerText;
    navigator.clipboard.writeText(text);
    alert("Metin panoya kopyalandÄ±.");
  };

  // Sesli oku
  document.getElementById("speak-btn").onclick = () => {
    const text = document.getElementById("result").innerText;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = "ar-SA"; // ArapÃ§a iÃ§in
    speechSynthesis.speak(utterance);
  };

  // Ä°ndir
  document.getElementById("download-btn").onclick = () => {
    const text = document.getElementById("result").innerText;
    const blob = new Blob([text], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "ocr_sonucu.txt";
    a.click();
  };
</script>

</body>
</html>
