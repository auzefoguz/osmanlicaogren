<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üïµÔ∏è Osmanlƒ±ca Dedektif Quiz</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Lateef&display=swap');

  body {
    font-family: 'Lateef', serif, Arial, sans-serif;
    background: #fdf9f3;
    color: #1a3b5d;
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }
  main {
    background: #fffdf9;
    max-width: 720px;
    border-radius: 15px;
    box-shadow: 0 0 30px rgba(0,0,0,0.12);
    padding: 2rem 2.5rem 3rem;
    position: relative;
  }
  header {
    font-size: 2.5rem;
    font-weight: 700;
    color: #a67c00;
    text-align: center;
    text-shadow: 0 0 3px #7a5c00;
    margin-bottom: 1.5rem;
    letter-spacing: 3px;
  }
  #story {
    font-style: italic;
    font-size: 1.2rem;
    color: #444;
    margin-bottom: 1.8rem;
    min-height: 120px;
    line-height: 1.5;
    border-left: 4px solid #a67c00;
    padding-left: 1rem;
    background: #fff7cc88;
    border-radius: 8px;
  }
  #question {
    font-size: 2rem;
    font-weight: 900;
    margin-bottom: 1rem;
    min-height: 80px;
    color: #4b3200;
    text-shadow: 0 1px 2px #f0e68c88;
    display: flex;
    align-items: center;
    gap: 0.8rem;
  }
  #question svg {
    width: 36px;
    height: 36px;
    fill: #a67c00;
  }
  ul.options {
    list-style: none;
    padding: 0;
    margin-bottom: 1.5rem;
    max-height: 320px;
    overflow-y: auto;
  }
  ul.options::-webkit-scrollbar {
    width: 8px;
  }
  ul.options::-webkit-scrollbar-thumb {
    background-color: #a67c00cc;
    border-radius: 4px;
  }
  ul.options li {
    background: #fef8d8;
    border: 2px solid transparent;
    margin-bottom: 1rem;
    padding: 1rem 1.3rem;
    border-radius: 14px;
    cursor: pointer;
    font-size: 1.4rem;
    font-weight: 600;
    transition: background-color 0.3s, border-color 0.3s;
    box-shadow: 1px 1px 4px #e2d48f88;
    display: flex;
    align-items: center;
    gap: 0.7rem;
  }
  ul.options li:hover {
    background-color: #a67c00;
    color: white;
    border-color: #7a5c00;
  }
  ul.options li.selected {
    background-color: #4b3200;
    color: #f7e58d;
    font-weight: 900;
    border-color: #a67c00;
    box-shadow: 0 0 10px #b39b00;
  }
  #feedback {
    background: #fff4b7;
    border-left: 6px solid #a67c00;
    padding: 1rem 1.2rem;
    font-weight: 700;
    font-size: 1.1rem;
    color: #6b4f00;
    border-radius: 8px;
    min-height: 60px;
    margin-bottom: 1.8rem;
    box-shadow: 1px 1px 5px #a67c0033;
  }
  button#next-btn {
    background-color: #a67c00;
    color: #fffdf9;
    border: none;
    padding: 1rem 2.2rem;
    font-size: 1.3rem;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 900;
    letter-spacing: 1px;
    transition: background-color 0.3s;
    box-shadow: 0 3px 7px #7a5c0055;
    user-select: none;
    display: block;
    margin: 0 auto 1rem;
  }
  button#next-btn:disabled {
    background-color: #d4c57f88;
    cursor: not-allowed;
    box-shadow: none;
  }
  button#next-btn:hover:not(:disabled) {
    background-color: #7a5c00;
  }
  #result {
    margin-top: 2rem;
    font-size: 1.7rem;
    font-weight: 800;
    text-align: center;
    color: #4b3200;
    line-height: 1.4;
    white-space: pre-line;
  }
  #controls {
    position: fixed;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 100;
  }
  #controls button {
    background: #a67c00;
    border: none;
    color: white;
    font-size: 1.8rem;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    cursor: pointer;
    box-shadow: 0 3px 7px #7a5c0055;
    transition: background-color 0.3s;
    user-select: none;
  }
  #controls button:hover {
    background-color: #7a5c00;
  }
</style>
</head>
<body>
<main>
  <header>üïµÔ∏è Osmanlƒ±ca Dedektif Gizemi</header>
  <div id="story"></div>
  <div id="question">
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Zm0 16a2 2 0 1 1 2-2 2 2 0 0 1-2 2Zm2-6h-4v-6h4Z"/>
    </svg>
    <span id="question-text"></span>
  </div>
  <ul class="options" id="options"></ul>
  <div id="feedback"></div>
  <button id="next-btn" disabled>Sonraki ƒ∞pucu</button>
  <div id="result"></div>
</main>

<div id="controls">
  <button id="home-btn" title="Ana Sayfa" aria-label="Ana Sayfa">üè†</button>
  <button id="restart-btn" title="Yeniden Ba≈ülat" aria-label="Yeniden Ba≈ülat">üîÑ</button>
  <button id="finish-btn" title="Bitir" aria-label="Bitir">‚èπÔ∏è</button>
</div>

<audio id="background-music" loop>
  <source src="haunting-middle-eastern-piece-188714.mp3" type="audio/mpeg" />
  Tarayƒ±cƒ±nƒ±z audio elementini desteklemiyor.
</audio>

<script>
  // Hikayeler 5 b√∂l√ºm
  const chapters = [
    `üìú Eski Osmanlƒ± ar≈üivinde ba≈ülayan gizemli dava. Dedektifimiz ilk ipucuna ula≈ütƒ±.`,
    `üï∞Ô∏è Tarih tozlarƒ± arasƒ±nda yeni ipu√ßlarƒ± ke≈üfediliyor. Dikkatli olmalƒ±!`,
    `‚úâÔ∏è Gizem derinle≈üiyor; mektuplar, yazmalar ve sƒ±rlar ortaya √ßƒ±kƒ±yor.`,
    `üìö Ar≈üiv odasƒ±nda gece yarƒ±sƒ±, kritik kelimeler dedektifi bekliyor.`,
    `üè´ Son ipucu bulundu. Osmanlƒ± sƒ±rlarƒ± √ß√∂z√ºlmek √ºzere...`
  ];

  // HTML elementleri
  const storyEl = document.getElementById("story");
  const questionEl = document.getElementById("question-text");
  const optionsEl = document.getElementById("options");
  const feedbackEl = document.getElementById("feedback");
  const nextBtn = document.getElementById("next-btn");
  const resultEl = document.getElementById("result");
  const homeBtn = document.getElementById("home-btn");
  const restartBtn = document.getElementById("restart-btn");
  const finishBtn = document.getElementById("finish-btn");

  let allWords = [];
  let currentIndex = 0;
  let score = 0;
  let answered = false;

  // M√ºzik
  const music = document.getElementById("background-music");
  music.volume = 0.15;
  music.play().catch(() => {
    console.log("M√ºzik otomatik ba≈ülamadƒ±.");
  });

  // B√∂l√ºm bulucu
  function getChapterByIndex(idx) {
    return chapters[Math.floor(idx / 5)] || "";
  }

  // Yanlƒ±≈ü se√ßenekler anlam i√ßin
  function getWrongMeanings(correctMeaning) {
    const meanings = allWords.map(k => k.meaning);
    return meanings.filter(m => m !== correctMeaning)
      .sort(() => 0.5 - Math.random())
      .slice(0,3);
  }
  // Yanlƒ±≈ü kelimeler eksik kelime i√ßin
  function getWrongWords(correctWord) {
    const words = allWords.map(k => k.word);
    return words.filter(w => w !== correctWord)
      .sort(() => 0.5 - Math.random())
      .slice(0,3);
  }

  // Yeni soru tipleri i√ßin (3 tip)
  function generateQuestion(wordObj) {
    const rnd = Math.random();
    if (rnd < 0.33) {
      // Anlam sorusu
      return {
        type: "meaning",
        question: `Bu kelimenin anlamƒ± nedir? (${wordObj.transliteration})`,
        correctAnswer: wordObj.meaning,
        explanation: wordObj.explanation
      };
    } else if (rnd < 0.66) {
      // Eksik kelime c√ºmlede
      return {
        type: "missing_word",
        question: `Dedektifin notlarƒ±nda ≈üu c√ºmle var: "Bug√ºn ${wordObj.meaning} √ßok √∂nemli." Hangi kelime eksiktir?`,
        correctAnswer: wordObj.word,
        explanation: `Doƒüru kelime: '${wordObj.word}' (${wordObj.transliteration})`
      };
    } else {
      // E≈üle≈ütirme (kelime anlam e≈üle≈ütir)
      return {
        type: "match",
        question: `Bu kelimenin Osmanlƒ±ca kar≈üƒ±lƒ±ƒüƒ± hangisidir? (${wordObj.meaning})`,
        correctAnswer: wordObj.word,
        explanation: `Doƒüru cevap: '${wordObj.word}' (${wordObj.transliteration})`
      };
    }
  }

  // Render soru ve se√ßenekler
  function renderQuestion() {
    answered = false;
    feedbackEl.textContent = "";
    nextBtn.disabled = true;
    optionsEl.innerHTML = "";
    resultEl.textContent = "";

    const wordObj = allWords[currentIndex];
    const chapter = getChapterByIndex(currentIndex);
    storyEl.textContent = chapter;

    const q = generateQuestion(wordObj);
    questionEl.textContent = q.question;

    let options = [];

    if (q.type === "meaning") {
      options = [q.correctAnswer, ...getWrongMeanings(q.correctAnswer)];
    } else if (q.type === "missing_word") {
      options = [q.correctAnswer, ...getWrongWords(q.correctAnswer)];
    } else if (q.type === "match") {
      options = [q.correctAnswer, ...getWrongMeanings(q.correctAnswer)];
    }

    options = options.sort(() => 0.5 - Math.random());

    options.forEach(opt => {
      const li = document.createElement("li");
      li.textContent = opt;
      li.addEventListener("click", () => {
        if (answered) return;
        answered = true;
        li.classList.add("selected");
        // Kilitle diƒüerleri
        [...optionsEl.children].forEach(el => el.style.pointerEvents = "none");

        if (opt === q.correctAnswer) {
          score++;
          feedbackEl.textContent = `‚úÖ Doƒüru! ${q.explanation}`;
          feedbackEl.style.color = "#2a5d1a";
        } else {
          feedbackEl.textContent = `‚ùå Yanlƒ±≈ü! ${q.explanation} Doƒüru cevap: "${q.correctAnswer}"`;
          feedbackEl.style.color = "#a62a2a";
        }
        nextBtn.disabled = false;
      });
      optionsEl.appendChild(li);
    });
  }

  nextBtn.addEventListener("click", () => {
    currentIndex++;
    if(currentIndex < allWords.length){
      renderQuestion();
    } else {
      showFinalResult();
    }
  });

  // Buton olaylarƒ±
  homeBtn.addEventListener("click", () => {
    window.location.href = "index.html";
  });
  restartBtn.addEventListener("click", () => {
    currentIndex = 0;
    score = 0;
    renderQuestion();
    feedbackEl.textContent = "";
    resultEl.textContent = "";
  });
  finishBtn.addEventListener("click", () => {
    showFinalResult();
  });

  function showFinalResult(){
    storyEl.style.display = "none";
    questionEl.parentElement.style.display = "none";
    optionsEl.style.display = "none";
    feedbackEl.style.display = "none";
    nextBtn.style.display = "none";

    let message = `üïµÔ∏è Osmanlƒ±ca Dedektif Gizemini √ß√∂zd√ºn!\n\nToplam ${allWords.length} ipucundan ${score} doƒüru cevap verdin.`;

    if(score === allWords.length){
      message += "\n\nüéâ Harika! T√ºm sƒ±rlarƒ± √ß√∂zd√ºn ve b√ºy√ºk bir Osmanlƒ±ca dedektifi oldun!";
    } else if(score >= allWords.length / 2){
      message += "\n\nüëç ƒ∞yi i≈ü √ßƒ±kardƒ±n, bazƒ± gizemler hala √ß√∂z√ºlmeyi bekliyor.";
    } else {
      message += "\n\nüòï Biraz daha √ßalƒ±≈ümalƒ±sƒ±n, Osmanlƒ±ca sƒ±rlarƒ± zorlu olabilir.";
    }

    resultEl.textContent = message;
  }

  // JSON dosyasƒ±nƒ± y√ºkle ve ba≈ülat
  fetch("kelimeler.json")
    .then(res => res.json())
    .then(data => {
      allWords = data.slice(0,25); // sadece 25 kelime
      renderQuestion();
    })
    .catch(() => alert("Kelime verisi y√ºklenemedi."));

</script>
</body>
</html>
